{% extends 'base.html.twig' %}

{% block title %}{% endblock %}

{% block body %}
  <style>
      .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
      .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
  </style>

  <div class="example-wrapper">
    {% for post in posts %}
      <div class="post-container">
        <h3 class="post-title">{{ post.title }}</h3>
        <p class="post-metadata">Posted by {{ post.author }} on {{ post.createdAt | date('d/m/Y') }} at {{ post.createdAt | date('H:i') }}</p>
        <a class="btn btn-primary" href="{{ path('post_show', {'id': post.id }) }}">See more</a>
        <a href="{{ path('post_like', {'id': post.id}) }}" class="btn btn-link js-like">
          {% if app.user and post.isLikedByUser(app.user) %}
            <i class="fas fa-thumbs-up"></i>
          {% else %}
            <i class="far fa-thumbs-up"></i>
          {% endif %}
          <span class="js-likes">{{ post.likes | length }}</span>
        </a>
      </div>
      <br>
    {% endfor %}
  </div>
{% endblock %}

{% block javascripts %}
  <script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>
    function onClickBtnLike(event){
      event.preventDefault();

      const url = this.href;
      const spanCount = this.querySelector('span.js-likes');
      const icone = this.querySelector('svg');

      axios.get(url).then(function(response){
        spanCount.textContent = response.data.likes;

        if (icone.dataset.prefix === 'fas') {
          icone.dataset.prefix = 'far';
        } else {
          icone.dataset.prefix = 'fas';
        }
      });
    }

    document.querySelectorAll('a.js-like').forEach(function(link){
      link.addEventListener('click', onClickBtnLike);
    })
  </script>
{% endblock %}
